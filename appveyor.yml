image: Visual Studio 2017

environment:
  ANDROID_HOME: "c:\\android"

init:
  - appveyor version
  - ps: '[System.IO.File]::AppendAllText("C:\Windows\System32\drivers\etc\hosts", "`n93.184.221.200`tapi.nuget.org")'
  - mkdir "%ANDROID_HOME%"
  - cd "%ANDROID_HOME%"
  - appveyor DownloadFile "https://dl.google.com/android/repository/tools_r25.2.5-windows.zip"
  - 7z x "tools_r25.2.5-windows.zip" > nul


install:

  - echo y | "%ANDROID_HOME%\tools\android.bat" --silent update sdk --no-ui --all --filter platform-tools,tools,build-tools-26.0.2,android-26,android-25,extra-google-m2repository,extra-android-m2repository
    # on windows we need to accept sublicenses for the new tooling, wee. 30 is an arbitrary number,
    # but should be the maximum number of licenses we explicitly need to type "Y ENTER" for.
    # also, the sdkmanager in all its glory leaks a bit of output to stderr, and powershell
    # and appveyor interpret that as errors, and blows up. so, when piping in our "Y ENTER"
    # responses, we invoke cmd so we can redirect stderr to stdout, and tell it to --update itself.
  - ps: for($i=0;$i -lt 30;$i++) { $response += "y`n"}; $response | cmd /c 'C:\android\tools\bin\sdkmanager.bat 2>&1' --update


version: 2.1.{build}

configuration: AppStore

# Retain the NuGet package cache between builds.
cache:
 # - C:\Users\appveyor\AppData\Local\NuGet\Cache
 # - '%USERPROFILE%\.nuget\packages-> **\packages.config'
 # try 
  - C:\projects\app-cross-platform-j312l\packages

#shallow_clone: true
platform: Any CPU

# restore packages
before_build:
  - nuget restore 

build:
  verbosity: minimal
